<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>音乐聆听 - 冰豆直播</title>
    <meta name="Keywords" content="音乐,在线听歌,音乐播放器,音乐网站,排行榜,热门歌曲,经典老歌">
    <meta name="description" content="海量音乐在线试听、新歌热歌在线首发、MV观看等，是互联网音乐播放和下载的优选。">
    <link href="https://cdnjs.bingdou.com.cn/bingdoulive/css/style.css" rel="stylesheet">
    <link href="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
</head>
<body oncontextmenu="return false" onselectstart="return false">
<header>
    <div class="header wrap">
        <h1 class="logo"><a href="/" title="冰豆直播"><i class="fa fa-video-camera"></i>冰豆直播</a></h1>
        <div class="menu">
            <div class="menu-icon"></div>
            <div class="menu-container" id="menu"></div>
        </div>
    </div>
</header>
<main class="wrap">
    <section class="list wrap-inner">
        <div class="list-header">
            <h3 id="categoryTitle">加载中...</h3>
        </div>
        <div class="list-w list-box playlist" id="musicList">
            <!-- 音乐列表将动态加载到这里 -->
            <div class="loading">正在加载音乐列表...</div>
        </div>
    </section>
</main>
<footer id="foot"></footer>
<script src="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.6.0/jquery.min.js"></script>
<script>
$('#menu').load('../../menu.html');
$('#foot').load('../../foot.html');
</script>
<script>
// URL参数解析
function getQueryParam(name) {
    const params = new URLSearchParams(window.location.search);
    return params.get(name);
}

// 安全HTML编码
function escapeHTML(str) {
    return str.replace(/&/g, '&amp;')
             .replace(/</g, '&lt;')
             .replace(/>/g, '&gt;')
             .replace(/"/g, '&quot;')
             .replace(/'/g, '&#039;');
}

// 加载音乐列表
async function loadMusicList() {
    const category = getQueryParam('cat');
    if (!category) {
        showError('缺少分类参数');
        return;
    }

    try {
        // 更新页面标题
        document.title = `${escapeHTML(category)} - 音乐聆听 - 冰豆直播`;
        document.getElementById('categoryTitle').textContent = escapeHTML(category);

        // 获取数据
        const response = await fetch(`https://json.bingdou.cc/music/list/?cat=${encodeURIComponent(category)}`);
        const data = await response.json();

        const listContainer = document.getElementById('musicList');
        listContainer.innerHTML = ''; // 清空加载提示

        if (!data || !data.data || !Array.isArray(data.data)) {
            showError('没有找到相关音乐列表');
            return;
        }

        // 生成列表项
        const listFragment = document.createDocumentFragment();
        data.data.forEach((item, index) => {
            const li = document.createElement('li');
            li.innerHTML = `
                <a href="../playlist/?id=${encodeURIComponent(item.id)}" 
                   title="${escapeHTML(item.title)}" 
                   target="_blank">
                    ${escapeHTML(item.title)}
                </a>
            `;
            listFragment.appendChild(li);
        });

        listContainer.appendChild(listFragment);

    } catch (error) {
        showError('数据加载失败，请稍后重试');
        console.error('加载失败:', error);
    }
}

// 显示错误信息
function showError(message) {
    const container = document.getElementById('musicList');
    container.innerHTML = `<div class="error">${message}</div>`;
    document.getElementById('categoryTitle').textContent = '加载出错';
}

// 页面加载后执行
window.addEventListener('DOMContentLoaded', () => {
    // 初始加载
    loadMusicList();
    
    // 监听分类变化（可选）
    window.addEventListener('popstate', loadMusicList);
});
</script>
</body>
</html>