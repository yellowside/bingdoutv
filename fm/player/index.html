<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>网络电台 - 冰豆直播</title>
<meta name="Keywords" content="广播电台,广播,FM,网络电台,在线收听" />
<meta name="description" content="囊括数千家FM广播电台,聚焦精品收听服务,提供有价值、有深度、有品质的声音内容。" />
<link href="https://cdnjs.bingdou.com.cn/bingdoulive/css/style.css" rel="stylesheet">
<link href="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css">
</head>
<body oncontextmenu="return false" onselectstart="return false">
<header>
  <div class="header wrap">
  <h1 class="logo"><a href="/" title="冰豆直播"><i class="fa fa-video-camera"></i>冰豆直播</a></h1>
  <div class="menu">
    <div class="menu-icon"></div>
    <div class="menu-container" id="menu"></div>
  </div>
</div>
</header>
<main class="wrap">
  <section class="list wrap-inner">
    <div class="list-header">
      <h3>正在播放-<span id="radioTitle">加载中...</span></h3>
    </div>
    <div class="list-w list-box" style="margin-bottom:20px;margin-right:0">
      <div id="APlayer">数据加载中…</div>
    </div>
  </section> 
<!-- 电台简介 -->  
  <section class="list wrap-inner">
    <div class="list-header">
      <h3>电台简介</h3>
    </div>
    <div class="list-text-box">
      <p id="radioDesc">加载中...</p>
    </div>
  </section>
<!-- 免责声明 -->  
  <section class="list wrap-inner">
    <div class="list-header">
      <h3>免责声明</h3>
    </div>
    <div class="list-text-box">
      <p>　　本站所有内容均自动搜索链接于互联网第三方网站页面，并不存储任何视频、音频资源。因此经由本站搜索所产生的任何结果皆不代表本站立场，本站不对其真实合法性以及版权负责，亦不承担任何法律责任。本站所有接口皆源于互联网，仅供学习交流。</p>
    </div>
  </section>
</main>
<footer id="foot"></footer>
<script src="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/1.12.4/jquery.js"></script>
<script src="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js" type="text/javascript"></script>
<script>
$('#menu').load('../../menu.html');
$('#foot').load('../../foot.html');
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const urlParams = new URLSearchParams(window.location.search);
    const videoid = urlParams.get('id');

    if (!videoid) {
      document.getElementById('radioTitle').innerText = '无效的电台ID';
      document.getElementById('radioDesc').innerText = '请提供 ?id=xxx 参数';
      return;
    }

    const apiUrl = 'https://json.bingdou.cc/fm/qtfm/?id=' + encodeURIComponent(videoid);

    fetch(apiUrl)
      .then(response => {
        if (!response.ok) throw new Error("网络请求失败：" + response.status);
        return response.json();
      })
      .then(json => {
        if (!json || !json.url || !json.title) {
          throw new Error("返回数据结构不完整");
        }

        const title = json.title || "未知电台";
        const desc = json.desc || "暂无简介";
        const mp3Url = json.url;
        let pic = json.pic || "";

        // ✅ 替换 http 为 https
        pic = pic.replace(/^http:/i, 'https:');
        // ✅ 设置默认封面（可自定义）
        if (!pic) {
          pic = "https://gh.bingdou.com.cn/gh/yellowside/jquery/img/thumb.jpg"; // 可以替换成你自己的图片链接
        }

        // 更新标题与描述
        document.title = `${title} - 网络电台 - 冰豆直播`;
        document.getElementById('radioTitle').innerText = title;
        document.getElementById('radioDesc').innerText = desc;

        // 清空播放器容器
        const playerContainer = document.getElementById('APlayer');
        playerContainer.innerHTML = '';

        // 初始化 APlayer
        try {
          const ap = new APlayer({
            element: playerContainer,
            narrow: false,
            autoplay: true,
            showlrc: false,
            music: {
              title: title,
              author: 'bingdou.live',
              url: mp3Url,
              pic: pic
            }
          });
          ap.init();
        } catch (e) {
          console.warn("播放器初始化失败", e);
        }
      })
      .catch(error => {
        console.error('数据加载失败:', error);
        document.getElementById('radioTitle').innerText = '加载失败';
        document.getElementById('radioDesc').innerText = '数据加载失败，请刷新重试。';
        document.getElementById('APlayer').innerHTML = '无法加载音频';
      });
  });
</script>
</body>
</html>